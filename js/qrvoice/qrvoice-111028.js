/* Copyright (c) 2011, Marcel Duran */
YUI.add("qrvoice",function(a){"use strict";var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s="qrvoice",t=s,u="R_039525bc02a0dbe1e6456752fdc17997",v="http://my.qrvoice.net/",w="http://api.bitly.com/v3/shorten?login="+t+"&apiKey="+u+"&longUrl={url}&format=json&callback={callback}",x="http://translate.google.com/translate_tts?ie=UTF-8&q={msg}&tl={lang}",y="http://chart.apis.google.com/chart?cht=qr&choe=UTF-8&chs={size}x{size}&chl={url}",z=33,A=547,B=10,C="hidden",D="lng-sel",E="body",F="</div>",G=a.one,H=a.Intl,I=H.get(s),J=a.substitute,K=a.config.win,L=K.location,M=K.navigator,N=a.StorageLite,O=N.getItem,P=N.setItem,Q=a.Node,R=Q.create,S=a.Object.each,T=encodeURIComponent,U=Math.round,V=null,W="value",X="lang",Y="placeholder",Z="title",$="click",_="size",ba="rtl",bb="id",bc=/[\d\w\-_]/g,bd=I.langs,be=M.userLanguage||M.language,bf=be.slice(0,2).toLowerCase(),bg=G(E),bh=bg.one("#form"),bi=bh.one("#msg"),bj=bg.one("#size"),bk=bg.one("#slider-thumb"),bl=bg.one("#qrcode-wrp"),bm=bg.one("#qrlink"),bn=bg.one("#slider-box"),bo=bh.one("#lang-lst"),bp=bh.one("#lang"),bq=bh.one("#lang-name"),br=(new a.apm.SimpleSlider({node:bn})).render(),bs=function(){var a=K.history;return a&&a.replaceState?function(b){a.replaceState(V,V,b?"?"+b:"/")}:function(a){L.hash=a}}(),bt=function(a,b){bi.get(W)||f.setXY(b||bi.getXY()),a&&a.halt()},bu=function(){return l==="zh"?"zh-CN":l},bv=function(a){bd.hasOwnProperty(a)||(a="en"),l=a,bi.set(X,bu()),bq.setContent(J(I.whichLang,{lang:bd[a]})),P(X,a)},bw=function(a,b){var c,d=a&&a.data;if(!d)return;c=d.url,r||(r=R('<img id="qrcode" alt="'+I.imgTitle+'">'),bl.append(r)),r.set("src",c),bm.set("href",c).setContent(c),b||bs("id="+c.slice(c.lastIndexOf("/")+1))},bx=function(b){var c,d,e=b&&b.data;if(!e)return;c=J(y,{size:h,url:T(e.url)}),d=J(w,{url:T(c)}),a.jsonp(d,{on:{success:bw}})},by=function(b){var c,d,e=bi.get(W),f=bu();b.halt(),e&&(m!==e||n!==f)&&(m=e,n=f,e=T(e),c=J(x,{msg:e,lang:f}),d=J(w,{url:T(c)}),a.jsonp(d,{on:{success:bx}}))};bh.on("submit",by),bg.delegate($,function(a){a.halt(),bo.toggleClass(C)},"#lang"),bg.delegate($,function(a){var b=function(a){return a===bp};a.target.ancestor(b)||bo.addClass(C)},E),bg.delegate($,function(a){var b=a.target;a.preventDefault(),G("#lng-"+l).removeClass(D),b.addClass(D),bv(b.get(bb).slice(4))},".lng"),br.on("valueChange",function(a){var c=q||U(a.newVal[0]*b)+z;q=0,c=c<z?z:c>A?A:c,h=c,P(_,c),bj.setContent(c+"x"+c),bl.setStyles({height:c,width:c})}),d=L.search,c=d.lastIndexOf("/"),c=c>-1?c:d.length,e=d.slice(1,c).split("&").concat(L.hash.slice(1).split("&")),a.Array.some(e,function(a){var b=a.split("="),c=b[1];if(b[0]===bb&&bc.test(c))return bw({data:{url:v+c}},1),1}),I.direction===ba&&bg.addClass(ba),G("#tagline").setContent(I.tagline),bi.set(Y,I.placeholder).set(Z,I.msgTitle),G("#lbl-msg").setContent(I.msgTitle),G("#gen").set(Z,I.genTitle),G("#lbl-gen").setContent(I.genLabel),bk.set(Z,I.resizeTitle),bm.set(Z,I.linkTitle),bl.set(Z,I.imgTitle),G("#lbl-intls").setContent(I.intlsTitle),G("#disclaimer").setContent(I.disclaimer),a.Lang.isUndefined(Q.getDOMNode(R("<input>"))[Y])&&(f=R('<label class="'+Y+'" for="msg">'+I.placeholder+"</label>"),bh.append(f),bt(),bi.on("focus",bt,V,[0,-1e4]),bi.on("blur",bt)),j="",g=H.getLang(s),S(I.intls,function(a,b){var c=a.ownName;j+='<option value="'+b+'"'+(b===g?" selected":"")+">"+a.name+(c?" - "+c:"")+"</option>"}),i=R('<select id="intls" title="'+I.intlsTitle+'">'+j+"</select>"),bg.one("#intls-wrp").append(i),i.on("change",function(){var a=i.get("options").item(i.get("selectedIndex")).get(W);P("intl",a),L.reload()}),N.on("storage-lite:ready",function(){p=parseInt(bn.getStyle("width"),10),b=(A-z+1)/p,h=O(_),h?q=h:h=p,br.update([U((h-z)/b),0]),bk.removeClass(C),bl.removeClass(C),bv(O(X)||bf),j='<div id="lang-hd">'+I.spokenLang+F,j+='<ul class="lang-col">',k=0,S(bd,function(a,b){j+='<li><a class="lng'+(b===l?" "+D:"")+'" href="#" id="lng-'+b+'">'+a+"</a></li>",k+=1,k%B===0&&(j+='</ul><ul class="lang-col">')}),j+='</ul><div id="lang-ft">'+I.langsNote+F,bo.setContent(j)}),G(".twitter-share-button").setAttribute("data-lang",g.slice(0,2)),o=g===bf?be:g,K.___gcfg={lang:o},K._gaq=[["_setAccount","UA-26587471-1"],["_trackPageview"],["_trackPageLoadTime"]],a.Get.script(["//www.google-analytics.com/ga.js","//connect.facebook.net/"+(o.length>2?o.replace("-","_"):"en_US")+"/all.js#xfbml=1","//platform.twitter.com/widgets.js","https://apis.google.com/js/plusone.js"],{async:!0})},"0.0.2",{lang:["en-US","pt-BR"],requires:["node","json","jsonp","substitute","dd-constrain","gallery-center","gallery-simpleslider","gallery-storage-lite"]})