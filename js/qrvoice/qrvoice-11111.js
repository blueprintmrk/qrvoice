/* Copyright (c) 2011, Marcel Duran */
YUI.add("qrvoice",function(a){"use strict";var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r="qrvoice",s=r,t="R_039525bc02a0dbe1e6456752fdc17997",u="http://my.qrvoice.net/",v="http://api.bitly.com/v3/shorten?login="+s+"&apiKey="+t+"&longUrl={url}&format=json&callback={callback}",w="http://translate.google.com/translate_tts?ie=UTF-8&q={msg}&tl={lang}",x="http://chart.apis.google.com/chart?cht=qr&choe=UTF-8&chs={size}x{size}&chl={url}",y="http://www.facebook.com/sharer.php?t=QR%20voice&u=http%253A%252F%252Fqrvoice.net%2F%3Fid%3D{id}",z="http://twitter.com/share?source=tweetbutton&text=QR%20voice&url=http%3A%2F%2Fqrvoice.net%2F%3Fid%3D{id}",A=33,B=547,C=10,D="hidden",E="lng-sel",F=".lbl",G="body",H="</div>",I=a.one,J=a.Intl,K=J.get(r),L=a.substitute,M=a.config.win,N=M.location,O=M.navigator,P=a.StorageLite,Q=P.getItem,R=P.setItem,S=a.Node,T=S.create,U=a.Object.each,V=encodeURIComponent,W=Math.round,X=null,Y="value",Z="lang",$="placeholder",_="title",ba="click",bb="size",bc="rtl",bd="id",be="href",bf=/[\d\w\-_]/g,bg=K.langs,bh=O.userLanguage||O.language,bi=bh.slice(0,2).toLowerCase(),bj=I(G),bk=bj.one("#form"),bl=bk.one("#msg"),bm=bj.one("#size"),bn=bj.one("#slider-thumb"),bo=bj.one("#qrcode-wrp"),bp=bj.one("#qrlink"),bq=bj.one("#slider-box"),br=bk.one("#lang-lst"),bs=bk.one("#lang"),bt=bk.one("#lang-name"),bu=bj.one("#social .facebook"),bv=bj.one("#social .twitter"),bw=(new a.apm.SimpleSlider({node:bq})).render(),bx=function(){var a=M.history;return a&&a.replaceState?function(b){a.replaceState(X,X,b?"?"+b:"/")}:function(a){N.hash=a}}(),by=function(a,b){bl.get(Y)||f.setXY(b||bl.getXY()),a&&a.halt()},bz=function(){return l==="zh"?"zh-CN":l},bA=function(a){bg.hasOwnProperty(a)||(a="en"),l=a,bl.set(Z,bz()),bt.setContent(L(K.whichLang,{lang:bg[a]})),R(Z,a)},bB=function(a,b){var c,d,e=a&&a.data;if(!e)return;c=e.url,d=e.hash,q||(q=T('<img id="qrcode" alt="'+K.imgTitle+'">'),bo.append(q)),q.set("src",c),bp.set(be,c).setContent(c),bu.set(be,L(y,{id:d})),bv.set(be,L(z,{id:d})),b||bx("id="+d)},bC=function(b){var c,d,e=b&&b.data;if(!e)return;c=L(x,{size:h,url:V(e.url)}),d=L(v,{url:V(c)}),a.jsonp(d,{on:{success:bB}})},bD=function(b){var c,d,e=bl.get(Y),f=bz();b.halt(),e&&(m!==e||n!==f)&&(m=e,n=f,e=V(e),c=L(w,{msg:e,lang:f}),d=L(v,{url:V(c)}),a.jsonp(d,{on:{success:bC}}))};bk.on("submit",bD),bj.delegate(ba,function(a){a.halt(),br.toggleClass(D)},"#lang"),bj.delegate(ba,function(a){var b=function(a){return a===bs};a.target.ancestor(b)||br.addClass(D)},G),bj.delegate(ba,function(a){var b=a.target;a.preventDefault(),I("#lng-"+l).removeClass(E),b.addClass(E),bA(b.get(bd).slice(4))},".lng"),bw.on("valueChange",function(a){var c=p||W(a.newVal[0]*b)+A;p=0,c=c<A?A:c>B?B:c,h=c,R(bb,c),bm.setContent(c+"x"+c),bo.setStyles({height:c,width:c})}),d=N.search,c=d.lastIndexOf("/"),c=c>-1?c:d.length,e=d.slice(1,c).split("&").concat(N.hash.slice(1).split("&")),a.Array.some(e,function(a){var b=a.split("="),c=b[1];if(b[0]===bd&&bf.test(c))return bB({data:{url:u+c,hash:c}},1),1}),K.direction===bc&&bj.addClass(bc),I("#tagline").setContent(K.tagline),bl.set($,K.placeholder).set(_,K.msgTitle),I("#lbl-msg").setContent(K.msgTitle),I("#gen").set(_,K.genTitle),I("#lbl-gen").setContent(K.genLabel),bn.set(_,K.resizeTitle),bp.set(_,K.linkTitle),bo.set(_,K.imgTitle),I("#lbl-intls").setContent(K.intlsTitle),I("#disclaimer").setContent(K.disclaimer),bu.one(F).setContent(K.facebookButton),bv.one(F).setContent(K.twitterButton),a.Lang.isUndefined(S.getDOMNode(T("<input>"))[$])&&(f=T('<label class="'+$+'" for="msg">'+K.placeholder+"</label>"),bk.append(f),by(),bl.on("focus",by,X,[0,-1e4]),bl.on("blur",by)),j="",g=J.getLang(r),U(K.intls,function(a,b){var c=a.ownName;j+='<option value="'+b+'"'+(b===g?" selected":"")+">"+a.name+(c?" - "+c:"")+"</option>"}),i=T('<select id="intls" title="'+K.intlsTitle+'">'+j+"</select>"),bj.one("#intls-wrp").append(i),i.on("change",function(){var a=i.get("options").item(i.get("selectedIndex")).get(Y);R("intl",a),N.reload()}),P.on("storage-lite:ready",function(){o=parseInt(bq.getStyle("width"),10),b=(B-A+1)/o,h=Q(bb),h?p=h:h=o,bw.update([W((h-A)/b),0]),bn.removeClass(D),bo.removeClass(D),bA(Q(Z)||bi),j='<div id="lang-hd">'+K.spokenLang+H,j+='<ul class="lang-col">',k=0,U(bg,function(a,b){j+='<li><a class="lng'+(b===l?" "+E:"")+'" href="#" id="lng-'+b+'">'+a+"</a></li>",k+=1,k%C===0&&(j+='</ul><ul class="lang-col">')}),j+='</ul><div id="lang-ft">'+K.langsNote+H,br.setContent(j)}),M._gaq=[["_setAccount","UA-26587471-1"],["_trackPageview"],["_trackPageLoadTime"]],a.later(0,X,function(){a.Get.script("//www.google-analytics.com/ga.js",{async:!0})})},"0.0.3",{lang:["en-US","pt-BR"],requires:["node","json","jsonp","substitute","dd-constrain","gallery-center","gallery-simpleslider","gallery-storage-lite"]})